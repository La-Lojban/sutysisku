import io from"./socket.io.js";import{initBackend}from"./asql/indexeddb-main-thread.js";const content=document.getElementById("content"),ciska=document.getElementById("ciska"),clear=document.getElementById("clear"),outp=document.getElementById("outp"),descr=document.getElementById("descr"),drata=document.getElementById("drata"),citri=document.getElementById("citri"),sidju=document.getElementById("sidju"),pb=document.getElementById("kernelo_lo_cpacu");let SiteTitleFull=document.querySelector("#site-title");const dasri=document.getElementById("galtu-dasri"),catni=document.getElementById("catni"),cnano=document.getElementById("cnano"),rimni=document.getElementById("rimni"),SiteImage=document.querySelectorAll("#title > img"),btnScrollToTop=document.getElementById("scrollToTop"),textArea=document.getElementById("audioParamsTextarea"),audio=document.querySelector("#audio"),loading=document.getElementById("loading"),CACHE_NAME="sutysisku";window.leijufra={};let jvoPlumbsOn=!0;const uncll_url="https://la-lojban.github.io/uncll/uncll-1.2.14/xhtml_section_chunks/",learnlojban_url="https://lojban.pw/books/learn-lojban/#",supportedLangs={en:{n:"English",p:"selsku_lanci_eng"},muplis:{n:"la muplis"},"en-cll":{n:"The Book",p:"cukta"},"en-ll":{n:"Learn Lojban",p:"cukta"},jbo:{n:"lojbo",p:"lanci_jbo"},ru:{n:"русский",p:"selsku_lanci_rus"},eo:{n:"esperanto",p:"lanci_epo"},es:{n:"español",p:"selsku_lanci_spa"},"fr-facile":{n:"français",p:"selsku_lanci_fra"},ja:{n:"日本語",p:"selsku_lanci_jpn"},zh:{n:"中文",p:"selsku_lanci_zho"}},listFamymaho={GA:"gi",GUhA:"gi",BE:"bei be'o",BEI:"be'o",BY:"boi",COI:"do'u",DOI:"do'u",FIhO:"fe'u",FUhE:"fu'o",GIhA:"vau",GOI:"ge'u",JOhI:"te'u",KE:"ke'e",LAhE:"lu'u",LA:"ku",LE:"ku",LI:"lo'o",LOhU:"le'u",LU:"li'u",ME:"me'u","NAhE+BO":"lu'u",NOI:"ku'o",NUhI:"nu'u",NU:"kei",PA:"boi",PEhO:"ku'e",SEI:"se'u",SOI:"se'u",TO:"toi",TUhE:"tu'u",VEI:"ve'o",LOhAI:"sa'ai",SAhAI:"le'ai",LOhOI:"ku'au",NAhU:"te'u",NIhE:"te'u",MOhE:"te'u"};let resultCount,typingTimer,results=[];const state={searching:{seskari:"cnano",versio:"masno",query:"",bangu:"en"},displaying:{seskari:"cnano",versio:"masno",query:"",bangu:"en"},citri:[]},loadingState={loading:!0,firstRun:!0,mathRendered:!1};try{const e=JSON.parse(localStorage.getItem("tcini"));e&&e.seskari&&(state.searching.seskari=e.seskari),e&&e.versio&&(state.searching.versio=e.versio),e&&e.bangu&&(state.searching.bangu=e.bangu)}catch(e){}state.citri=macitri();const timers={vh:null,typing:null};let scrollTimer=null,scrollJvoTimer=null;const UNICODE_START=60800,lerfu_index="ptkflscmx.' 1234bdgvrzjn`-,~    aeiouy    qw    AEIOUY",rows=[["p","t","k","f","s","c"],["b","d","g","v","z","j"],["m","l","n","r",,"x","'"],["a","e","i","o","u","y"],[],["aia","aua"],["au","ai","ei","oi"]];let socket,socket1Chat,socket1Chat_connected;ciska.focus();const pollyParams={IdentityPoolId:"us-east-1:35da84f8-d67e-4977-b07d-37650808ea00",region:"us-east-1",VoiceId:"Vicki",LanguageCode:"de-DE",Engine:"neural",lojban2IPAMapping:{"«":"","-":".","»":"","\\?":"",",":"","\\.":"ʔ"," ":" ",ˈ:"ˈ",a:"aː","a\\b(?!')":"aː",e:"ɛ:","e\\b(?!')":"ɛ:ʔ",i:"i:",o:"ɔ:",u:"u:",y:"ə",ą:"aj",ę:"ɛj","ę\\b(?!')":"ɛjʔ",ǫ:"ɔj",ḁ:"aʊ",ɩa:"jaː",ɩe:"jɛ:",ɩi:"ji:",ɩo:"jɔ:",ɩu:"ju:",ɩy:"jə",ɩ:"j",wa:"waː",we:"wɛ:",wi:"wi:",wo:"wɔ:",wu:"wu:",wy:"wə",w:"w",c:"ʃ",j:"ʒ",s:"s",z:"z",f:"f",ev:"ɛ:ʔv",v:"v",x:"x","'":"h",dj:"dʒ",tc:"tʃ",dz:"ʣ",ts:"ʦ","r(?=[^aeiouyḁąęǫ])":"rr.","r(?=[aeiouyḁąęǫ])":"ɹ",n:"n",m:"m",l:"l",b:"b",d:"d",g:"g",k:"k",p:"p",t:"t"}};let audioParams;window.pollyParams=pollyParams;try{audioParams=JSON.parse(localStorage.getItem("audioParams"))}catch(e){}audioParams&&audioParams.IdentityPoolId?window.pollyParams=audioParams:localStorage.setItem("audioParams",JSON.stringify(window.pollyParams)),window.delay=(e,t,a)=>{clearTimeout(timers[a]),timers[a]=setTimeout(e,t)},document.addEventListener("animationstart",listenToSearchRendered,!1),citri.addEventListener("click",clicked),window.addEventListener("popstate",setStateFromUrl),ciska.addEventListener("paste",typing(0)),ciska.addEventListener("keyup",(()=>{typing()})),ciska.addEventListener("keydown",(()=>{clearTimeout(typingTimer)})),ciska.addEventListener("input",typing()),ciska.addEventListener("textInput",typing()),ciska.addEventListener("focus",focusSearch),clear.addEventListener("click",window.EmptyState),rimni.addEventListener("click",(()=>{state.searching={...state.displaying,seskari:"rimni",versio:"masno",query:plukaquery(ciska.value)},DispatchState({replace:!1})})),document.getElementById("cnano").addEventListener("click",(()=>{state.searching={...state.displaying,seskari:"cnano",versio:"masno",query:plukaquery(ciska.value)},DispatchState({replace:!1})})),document.getElementById("catni").addEventListener("click",(()=>{state.searching={...state.displaying,seskari:"catni",versio:"masno",query:plukaquery(ciska.value)},DispatchState({replace:!1})})),window.addEventListener("resize",calcVH,!0),content.addEventListener("scroll",checkScrolledNearBottom),document.attachEvent?document.attachEvent("onkeyup",handler):document.addEventListener("keyup",handler),textArea.addEventListener("input",(()=>{try{const e={...pollyParams,...window.pollyParams,...JSON.parse(textArea.value)};localStorage.setItem("audioParams",JSON.stringify(e)),polly=PollyPlayer(e),localStorage.setItem("cachedAudio",null)}catch(e){}})),document.addEventListener("keyup",openSettingsModal,!1);const worker=new Worker("worker.js?sisku=1637915923237");initBackend(worker);try{setStateFromUrl({replace:!0})}catch(e){}RenderCitri(),calcVH();let polly=PollyPlayer(window.pollyParams);function showLoaded(){loadingState.loading=!1,addAudioLinks(),delete loadingState.resultsHash,loading.style.display="none",document.getElementById("contentWrapper").style.paddingBottom="0"}function showLoading({completedRows:e,totalRows:t,bangu:a,hideProgress:n}){loading.style.display="inline-flex",document.getElementById("contentWrapper").style.paddingBottom="28px";const s=document.getElementById("cpacu");if(n)s.style.display="none";else{const a=Math.min(100,Math.max(10,100*parseFloat(e)/parseFloat(t)));s.style.display="block",pb.style.width=`${a}%`}document.getElementById("bangu_loading").innerHTML=a}async function getCache({mode:e}){const t=await caches.open(CACHE_NAME),a=await getCachedList(),n=a.length,s=await fetch(`/sutysisku/data/tcini.json?sisku=${(new Date).getTime()}`);if(!s.ok)return 0===n&&alert("Are you offline? We can't fetch the source."),!1;const i=(await s.json()).vreji.map((e=>new URL(e,window.location.origin+window.location.pathname).href));let r=!1;for(let a=0;a<i.length;a++){const n=i[a];if("co'a"===e&&!/(\.(js|wasm|html|css)|\/$)/.test(n))continue;await t.match(n)||(await t.add(n),r=!0,"co'a"===e&&showLoading({completedRows:a,totalRows:i.length,bangu:"📦 💾 📁 🛠️"}))}for(const e of a)i.includes(e.url)||(await t.delete(e.url,{ignoreMethod:!0,ignoreVary:!0}),console.log({event:"removing cache",url:e.url}));return r&&await t.add(new URL("index.html",window.location.origin+window.location.pathname).href),showLoaded(),"co'a"===e&&r&&window.location.reload(),!0}async function getCachedList(){const e=await caches.open(CACHE_NAME);return await e.keys()}function macitri(){let e=[];try{return JSON.parse(localStorage.getItem("citri"))||e}catch(e){}return e}function RenderCitri(){state.citri.length>0&&(citri.innerHTML=` <span class="romoi_lehiseciska" data-jufra="window.purc">${window.purc||""}</span>${state.citri.filter((({seskari:e})=>"velcusku"!==e)).map((({seskari:e,versio:t,query:a,bangu:n})=>`<a class="a-${e}" href="#seskari=${e}&versio=${t}&sisku=${encodeUrl(a)}&bangu=${n}">${escHtml(a)}</a>`)).join(", ")}`)}function RenderDasri({seskari:e,sepia:t}){const a=["velcusku","arxivo","cnano","rimni","catni","fanva"];if("muplis"===state.displaying.bangu?document.getElementById("leitutci").style.display="none":document.getElementById("leitutci").style.display="flex",a.includes(e)||(e="cnano"),dasri.className=`kampu-dasri ${e}-dasri noselect`,SiteTitleFull.classList.add(`${e}-search-mode-title-color`),SiteTitleFull.classList.remove("desktop-mode-title-color"),document.getElementById(e)&&document.getElementById(e).classList.add(`${e}-tutci-hover`,"tutci-hover"),a.map((t=>{t!==e&&(SiteTitleFull.classList.remove(`${t}-search-mode-title-color`),document.getElementById(t)&&document.getElementById(t).classList.remove(`${t}-tutci-hover`,"tutci-hover"))})),t)for(let e=0;e<SiteImage.length;e++)SiteImage[e].style.filter=t}function listenToSearchRendered(e){"nodeInserted"==e.animationName&&(!0!==loadingState.loading&&addAudioLinks(),SwitchRotation({action:"stop"}))}function SwitchRotation({action:e,quick:t}){if("complete"!==document.readyState)return;const a=["logo"];"start"===e?(a.map((e=>{document.getElementById(e).classList.remove("stopRotate"),document.getElementById(e).classList.add("rotate")})),clear.classList.add("pulsate-css"),setTimeout((()=>{clear.classList.contains("pulsate-css")&&ciska.classList.add("granim-css")}),t?100:500)):(a.map((e=>{document.getElementById(e).classList.add("stopRotate")})),ciska.classList.remove("granim-css"),clear.classList.remove("pulsate-css"))}function EmitVelcusku(){}function renderMathAndPlumbs(){MathJax.typesetPromise().then((()=>{addJvoPlumbs(!0)}))}document.getElementById("audioParamsTextarea").value=JSON.stringify(window.pollyParams,null,2),window.addEventListener("load",(async()=>{await getCache({mode:"co'a"}),console.log({crossOriginIsolated:window.crossOriginIsolated}),worker.postMessage({kind:"fancu",cmene:"ningau_lesorcu",...state.searching}),updateLocales(),"serviceWorker"in navigator||("https:"===location.protocol?alert("Your browser is not supported. Please, upgrade to the latest Chrome / Firefox / Safari and don't use the app in incognito / private browsing mode (it needs to save dictionary data to disk to work successfully)."):(alert("HTTP protocol, la sutysisku won't work."),console.log("http protocol, service worker won't work")))})),content.onscroll=()=>{content.scrollTop>200?(btnScrollToTop.style.display="block",btnScrollToTop.classList.remove("dizlo")):btnScrollToTop.classList.add("dizlo")},window.switchBorderScroll=()=>{content.scrollTop>200?content.scrollTop=0:content.scrollTop=content.scrollHeight};const hashResults=({query:e,seskari:t,bangu:a,len:n})=>`${e}${t}${a}${n}`;function RenderResults({query:e,seskari:t,bangu:a,versio:n}){if(loadingState.loading){const n=hashResults({query:e,seskari:t,bangu:a,len:results.length});if(""!==state.displaying.query&&loadingState.resultsHash===n)return;loadingState.resultsHash=n}switch(removePlumbs(),window.jimte="velcusku"===t?201:30,resultCount=0,outp.innerHTML="",skicu_rolodovalsi({query:e,seskari:t,bangu:a,versio:n}),0===results.length&&SwitchRotation({action:"stop"}),state.displaying={...state.displaying,query:e,versio:n,seskari:t,bangu:a},outp.style.display="block",descr.style.display="none",drata.style.display="none",sidju.style.display="flex",content.scrollTop=0,state.displaying.seskari){case"rimni":renderMathAndPlumbs(),RenderDasri({seskari:"rimni",sepia:"sepia(}1.0)"});break;case"arxivo":RenderDasri({seskari:"arxivo",sepia:"none"});break;case"velcusku":RenderDasri({seskari:"velcusku",sepia:"none"});break;case"catni":renderMathAndPlumbs(),RenderDasri({seskari:"catni",sepia:"none"});break;case"fanva":renderMathAndPlumbs(),RenderDasri({seskari:"fanva",sepia:"none"});break;default:renderMathAndPlumbs(),RenderDasri({seskari:"cnano",sepia:"none"})}DispatchCitri(),ga("send","pageview",`#sisku/${state.displaying.query}`);const s={dl:window.location.href,dt:document.title,dr:document.referrer,dp:`#sisku/${state.displaying.query}`,dh:`${window.location.protocol}//${window.location.hostname}`,z:Math.round(1e12*Math.random())};socket&&socket.emit("sisku",s)}function removePlumbs(){[].forEach.call(document.querySelectorAll(".leader-line"),(function(e){e.parentNode.removeChild(e)}))}function appendPlumbs(){[].forEach.call(document.querySelectorAll(".leader-line"),(function(e){document.querySelector("#content").appendChild(e)}))}function addJvoPlumbs(e){scrollJvoTimer=setTimeout((()=>{if(removePlumbs(),addPlumbs(),!0!==e){const e=document.getElementsByClassName("jvo_plumber");jvoPlumbsOn=!jvoPlumbsOn;for(var t=0;t<e.length;t++){const a=e[t];a.value=jvoValue(),jvoPlumbsOn?a.classList.add("tutci-hover"):a.classList.remove("tutci-hover")}}if(!jvoPlumbsOn)return;const a=Array.from(document.querySelectorAll("[data-arr]"));for(let e=0;e<a.length;e++){const t=a[e],n=t.id,s=t.attributes["data-arr"].nodeValue.split(","),i=t.id.split("_").slice(0,-1),r=kahe_sezgana(t);a.filter((e=>{const t=e.id.split("_").slice(0,-2),a=e.attributes["data-arr"].nodeValue.split(","),l=a[0].split(/(?=[0-9]+)/);if(1===a.length&&t.length===i.length&&t.join("_")===i.join("_")&&s.filter((e=>{const t=e.split(/(?=[0-9])/);return 0===l[0].indexOf(t[0])&&l[1]===t[1]})).length>0&&(r||kahe_sezgana(e))){let t=e.attributes["data-color"].nodeValue;t=`hsla(${t},100%,70%,0.62)`,new LeaderLine(document.getElementById(e.id),document.getElementById(n),{endPlugColor:t,color:t,dash:{animation:!0},startSocketGravity:[50,-67],endSocketGravity:[0,67],endPlug:"arrow2",endSocket:"bottom",size:3})}})),appendPlumbs()}}),!0===e?450:0)}function addPlumbs(){const e=document.querySelectorAll("[data-target]");for(let t=0;t<e.length;t++){const a=e[t];if(kahe_sezgana(a)){const e=a.id,t=a.attributes["data-target"].nodeValue;let n=document.getElementById(t).attributes["data-color"].nodeValue;n=`hsla(${n},100%,70%,0.62)`,new LeaderLine(document.getElementById(t),document.getElementById(e),{endPlugColor:n,color:n,dash:{animation:!0},startSocketGravity:[50,-67],endSocketGravity:[0,67],endPlug:"arrow2",endSocket:"bottom",size:3})}}appendPlumbs()}function kahe_sezgana(e){const t=e.getBoundingClientRect();return t.top>=42&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}function twoJsonsAreEqual(e={},t={}){let a=!0;if(Object.keys(e).length==Object.keys(t).length){for(const n in e)if(e[n]!=t[n]){a=!1;break}}else a=!1;return a}function parseQuery(e){if(""===e)return;const t={};let a="";a=0===e.search(/^#sisku\//)?[e.replace(/#sisku\/(.*)/,"sisku=$1")]:("#"===e[0]?e.substr(1):e).split("&");for(let e=0;e<a.length;e++){const n=a[e].split("=");n[1]&&(t[decodeURIComponent(n[0])]=decodeURIComponent(n[1].replace(/[\+]/g," ")||""))}return t}function setStateFromUrl({href:e,replace:t}){e&&(e=e.substring(e.indexOf("#")+1),localStorage.setItem("url",`#${e}`));let a,n=parseQuery(e||window.location.hash)||{};if(n&&n.sisku)a=decodeUrl(n.sisku);else{e=(e=e||window.location.search).substring(e.indexOf("?")+1);a=decodeUrl(new URLSearchParams(e).get("focus")||""),a&&(n={sisku:a,seskari:"cnano"})}const s={...state.searching};n.seskari&&["velcusku","cnano","catni","rimni","arxivo","fanva"].includes(n.seskari)&&(s.seskari=n.seskari),s.versio="masno",n.versio&&["selmaho"].includes(n.versio)&&(s.versio=n.versio),n.bangu&&Object.keys(supportedLangs).includes(n.bangu)&&(s.bangu=n.bangu),n.sisku&&(s.query=a),twoJsonsAreEqual(s,state.searching)||(state.searching={...state.searching,...s},DispatchState({replace:t}))}function clicked({target:e}){if("A"===e.nodeName){const t=e;if(t.ctrlKey||t.metaKey)return;setStateFromUrl({replace:!1,href:t.getAttribute("href")})}}function setUrlFromState({replace:e}){let t="";state.searching.versio&&(t=`&versio=${state.searching.versio}`);let a=`${window.location.href.split("?")[0].split("#")[0]}#seskari=${state.searching.seskari}&sisku=${encodeUrl(state.searching.query)}&bangu=${state.searching.bangu}${t}`;""===state.searching.query?(a="",document.title="la sutysisku"):document.title=`${state.searching.query} - la sutysisku`;const n=localStorage.getItem("url")||"";!0===e?window.history.replaceState({},null,a):window.location.hash!==a&&n!==a&&window.history.pushState({},null,a),localStorage.setItem("url",a)}function GetCiskaAndDispatch(){state.searching.query=plukaquery(ciska.value),DispatchState({caller:"GetCiskaAndDispatch"})}function typing(e){clearTimeout(typingTimer);let t=250;"muplis"===state.searching.bangu&&(t=500),typingTimer=setTimeout(GetCiskaAndDispatch,e||t)}function focusSearch(){loadingState.firstRun?loadingState.firstRun=!1:(state.searching.query=plukaquery(ciska.value),DispatchState({quickRotation:!0}))}function DispatchCitri(){if(["fanva","velcusku"].includes(state.displaying.seskari)||""===state.displaying.query)return;let e=0;for(e=0;e<state.citri.length;e++)if(state.citri[e].query===state.displaying.query&&state.citri[e].seskari===state.displaying.seskari){state.citri.splice(e,1);break}state.citri.unshift({...state.displaying}),state.citri.length>10&&(state.citri.length=10),localStorage.setItem("citri",JSON.stringify(state.citri)),RenderCitri()}function DispatchState({replace:e,caller:t,empty:a,quickRotation:n}){if(updateLocales(),state.searching.query=state.searching.query,setUrlFromState({replace:e}),localStorage.setItem("tcini",JSON.stringify(state.searching)),1==a)return state.searching.query="",RenderDesktop();if("velcusku"!==state.searching.seskari){if(""===state.searching.query)return RenderDesktop();if(twoJsonsAreEqual(state.searching,state.displaying))return}switch(ciska.value=state.searching.query,SwitchRotation({action:"start",quick:n}),"GetCiskaAndDispatch"===t&&"velcusku"===state.searching.seskari&&(state.searching.seskari="cnano"),state.searching.seskari){case"arxivo":const e={...state.searching};"^"!==state.searching.query.charAt(0)&&"$"!==state.searching.query.slice(-1)[0]&&(e.query=`\\b${state.searching.query}\\b`),e.max=20,socket&&socket.emit("cpedu_fi_la_arxivo",e);break;case"velcusku":EmitVelcusku();break;default:loadingState.loading&&worker.postMessage({kind:"fancu",cmene:"cnino_bangu",...state.searching}),worker.postMessage({kind:"newSearch",versio:"masno",...state.searching,leijufra:window.leijufra,loadingState})}}function updateDOMWithLocales(e,t){if(!e.window)return;for(const t in e.window){const a=t.replace("window.","");window.leijufra[a]=window[a]=e.window[t]}Array.from(document.querySelectorAll("[data-jufra]")).forEach((t=>{const a=t.attributes["data-jufra"].nodeValue;let n=e[a];if(0===a.indexOf("window.")){n=e.window[a];const t=a.replace("window.","");window[t]=e.window[a]}if("INPUT"===t.nodeName)t.placeholder=n||t.placeholder;else t.innerHTML=n||t.innerHTML})),SiteTitleFull=document.querySelector("#site-title"),RenderDasri({...t,sepia:"none"}),""===state.displaying.query&&RenderDesktop(t);const a=document.getElementById("velsku_sebenji");a&&(a.href=`#seskari=cnano&sisku=lai jbosnu&bangu=${getStateBangu()}&versio=masno`)}function updateLocales(){worker.postMessage({kind:"fancu",cmene:"tejufra",...state.searching})}function RenderDesktop(e){e||SwitchRotation({action:"stop"}),e=e||state.displaying,removePlumbs(),content.scrollTop=0;const t=e.query;state.displaying.query="",SiteTitleFull.classList.add("desktop-mode-title-color"),SiteTitleFull.classList.remove("catni-search-mode-title-color","cnano-search-mode-title-color","velcusku-search-mode-title-color","rimni-search-mode-title-color","fanva-search-mode-title-color","arxivo-search-mode-title-color");try{catni.classList.remove("catni-tutci-hover","tutci-hover")}catch(e){}try{cnano.classList.remove("cnano-tutci-hover","tutci-hover")}catch(e){}try{rimni.classList.remove("rimni-tutci-hover","tutci-hover")}catch(e){}dasri.className="kampu-dasri cnano-dasri",outp.style.display="none",descr.style.display="block";const a={"@CLL":{bangu:"english",cmene:"Reference Grammar",pixra:"../pixra/cll.png",url:uncll_url},"@lojban.pw":{cmene:"Live chat for your questions",pixra:"../pixra/nunsku.svg",url:`#seskari=cnano&sisku=lai jbosnu&bangu=${getStateBangu()}&versio=masno`},"@LL":{bangu:"english",cmene:"Learn Lojban",pixra:"../pixra/cogwheel-5.svg",url:learnlojban_url},muplis:{cmene:"la muplis",pixra:"../pixra/taplamuplis.svg",width:2.1},en:{cmene:"English-Lojban",pixra:"../pixra/selsku_lanci_eng.svg"},jbo:{cmene:"fanva fi le'e lojbo ri",pixra:"../pixra/lanci_jbo.svg"},ja:{cmene:'日本 - <span style="white-space:pre;">ロジバン</span>',pixra:"../pixra/selsku_lanci_jpn.svg"},"fr-facile":{cmene:"français facile - lojban",pixra:"../pixra/selsku_lanci_fra.svg"},ru:{cmene:"русский - ложбан",pixra:"../pixra/selsku_lanci_rus.svg"},eo:{cmene:"Esperanto - Loĵbano",pixra:"../pixra/lanci_epo.svg"},es:{cmene:"español - lojban",pixra:"../pixra/selsku_lanci_spa.svg"},zh:{cmene:"中文 - 逻辑语",pixra:"../pixra/selsku_lanci_zho.svg"}};let n="";const s=100;for(const i in a){let{bangu:r,width:l,pixra:o,url:c,cmene:u}=a[i];l||(l=1),r&&r!==window.bangu||(n+=`<div class='DIV_1' style='height:100px;width:${l*s}px;'><div class='DIV_2' style='height:100px;width:${l*s}px;'><span class='SPAN_3' style='width:auto;'><b class='B_4'>${window.leijufra[u]||u}</b></span><a${0===(c||"").indexOf("http")?" rel='noreferrer' target='_blank'":""} aria-label="${u.replace(/<[^>]+?>/g,"")}" onclick="window.ningau_lepasorcu('${i}')" href="${0===i.indexOf("@")?c:`#seskari=${"fanva"!==e.seskari?e.seskari:"catni"}&sisku=${encodeUrl(t)}&bangu=${i}&versio=masno`}" class='A_7'><div class='DIV_8' style='height:100px;width:${l*s}px;background-image:url("${o}")'></div></a></div></div>`)}drata.innerHTML=n,drata.style.display="block"}function handler({keyCode:e}){e&&191===e&&ciska.focus()}function calcVH(){const{clientHeight:e}=document.getElementById("galtu-dasri"),{clientHeight:t}=document.getElementById("loading"),{clientHeight:a}=document.getElementById("velsku");content.setAttribute("style",`height:${Math.max(document.documentElement.clientHeight-e-t-a,window.innerHeight-e-t-a,50)}px;`)}function checkScrolledNearBottom({target:e}){removePlumbs(),null!==scrollTimer&&clearTimeout(scrollTimer),null!==scrollJvoTimer&&clearTimeout(scrollJvoTimer),"velcusku"!==state.displaying.seskari&&e.scrollTop+window.innerHeight>=outp.clientHeight-700?(window.jimte+=10,skicu_rolodovalsi(state.displaying),MathJax.typesetPromise().then((()=>{addJvoPlumbs(!0)}))):addJvoPlumbs(!0),addAudioLinks()}function bgString2Int(e,{s:t,l:a}){const n=`,${t||"90%"},${a||"80%"}`,s=e.split(",");let i=[];for(let e=0;e<s.length;e++){const t=string2Int(s[e],256,32);0===e?i.push(`hsl(${t}${n}),hsl(${t}${n}) ${100*(e+1)/s.length}%`):e===s.length-1?i.push(`hsl(${t}${n}) ${100*e/s.length}%,hsl(${t}${n})`):i.push(`hsl(${t}${n}) ${100*e/s.length}%,hsl(${t}${n}) ${100*(e+1)/s.length}%`)}return i.join(",")}worker.onmessage=e=>{const{data:t}=e,{kind:a,cmene:n}=t;if("searchResults"==a){if(delete loadingState.searching,!t.force&&!twoJsonsAreEqual(t.req,state.searching))return;results=t.results||[],RenderResults({...t.req})}else if("parse"==a&&t.req&&"audioLink"==t.req.operation){let e=(t.req.tegerna||"").replace(/"/g,"");if(!e)return;const a=encodeValsiForWeb(e);t.results=t.results.map((e=>[e[0],e[1].replace(/-/g,"")]));if(!allAreSafeWords(t.results,{allowCmavo:!0,allowCmevla:!0}))return;e=t.results.map((e=>e[1])).join(" ");const n=Array.from(document.querySelectorAll(`[data-valsi="${a}"]`))[0],s=Array.from(document.querySelectorAll(`[data-valsi-play="${a}"]`))[0];if(n&&!s)try{window.runSpeakableAudio(e,!0)&&n.insertAdjacentHTML("afterend",`<button class="tutci sance" data-valsi-play="${a}" onclick="window.runSpeakableAudio(&quot;${e}&quot;)">▶</button>`)}catch(e){}}else if("loader"==a)"loading"===n?(t.banguRaw!==state.searching.bangu&&0!==t.completedRows&&t.completedRows!==t.totalRows||t.completedRows!==t.totalRows&&twoJsonsAreEqual(loadingState.searching,state.searching)||(loadingState.searching=state.searching,loadingState.loading=!0,worker.postMessage({kind:"newSearch",versio:"masno",...state.searching,leijufra:window.leijufra,loadingState})),showLoading({completedRows:t.completedRows,totalRows:t.totalRows,bangu:"🗃️ "+t.bangu})):"loaded"===n?(showLoaded(),getCache({mode:"ca'o"})):"booting"===n&&showLoading({completedRows:1,totalRows:3,bangu:"🗃️ "+(window.booting||"")}),calcVH();else if("fancu"==a&&"tejufra"===n)updateDOMWithLocales(t.results,{...state.searching,...t.datni})},socket&&socket.on("la_arxivo_cu_cusku",(({seskari:e,query:t,message:a})=>{state.searching.seskari===e&&state.searching.query===t&&(results=a||[],RenderResults({query:t,seskari:e}))})),window.EmptyState=e=>{"string"==typeof e&&(state.searching.bangu=e,updateLocales()),DispatchState({empty:!0})},"loading"===document.readyState&&(pb.style.width="37%",document.title="la sutysisku");const cyrb53=function(e,t=0){let a=3735928559^t,n=1103547991^t;for(let t,s=0;s<e.length;s++)t=e.charCodeAt(s),a=Math.imul(a^t,2654435761),n=Math.imul(n^t,1597334677);return a=Math.imul(a^a>>>16,2246822507)^Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507)^Math.imul(a^a>>>13,3266489909),4294967296*(2097151&n)+(a>>>0)};function string2Int(e,t,a){return e=e.replace(/[\{\}_]/g,""),Math.abs(Math.round(cyrb53(e)%t/a)*a)}function getVeljvoLetters(e){const t=(e=e.substr(1,e.length-2).split("=")).map((e=>e.replace(/[^A-Za-z']/g,"")));return{jalge:t,hasExpansion:e.length>1||t[0]&&"x"!==t[0]}}function getVeljvoString({placeTag:e,fullDef:t,isHead:a,dataArrAdded:n,clearedPlaceTag:s}){const i=(t.rfs||[]).map((e=>e.w));if(a&&"lujvo"!==t.t)return{dataArr:!1,replacement:e,stringifiedPlaceTag:e};const r=e.substr(1,e.length-2).split("=").map((e=>{const n=e.split(/(?=[_0-9].*)/),s=i.filter((e=>0===e.indexOf(n[0])))[0];return{full:a?s||n[0]:t.w,number:n.slice(1).join(""),short:a?n[0]:t.w,hasMatchInRFS:!!s}})),l=r.filter((e=>e.hasMatchInRFS||!a)).map((e=>e.full+e.number.replace(/[_\{\}]/g,""))).join(","),o=r.map((e=>e.full+e.number)).join("=");return{stringifiedPlaceTag:l,dataArr:!n.includes(s),replacement:`$${o}$`}}function melbi_uenzi({def:e,fullDef:t,query:a,seskari:n,bangu:s,type:i,index:r}){if(t){if(t.bangu.indexOf("-cll")>=0){return{tergeha:`<ul class='uoldeliste' style="list-style-image: url(../pixra/cukta.svg);">${Object.keys(e).map((t=>{const a=e[t];return`<li><a rel='noreferrer' target='_blank' href="${uncll_url}${t}">${a}</a></li>`})).join("")}</ul>`,hasExpansion:!1}}if(t.bangu.indexOf("-ll")>=0){return{tergeha:`<ul class='uoldeliste' style="list-style-image: url(../pixra/certu.svg);">${Object.keys(e).map((t=>{const a=e[t];return`<li><a rel='noreferrer' target='_blank' href="${learnlojban_url}${t}">${a}</a></li>`})).join("")}</ul>`,hasExpansion:!1}}}const l=/<\/?a [\s\S]*>/i.test(e);let o=0;const c=[],u=[],d=[];let p=!1;["cnano","catni","rimni"].includes(n)||(n="cnano");const g=e.match(/\$.*?\$/g)||[];for(const e of g)if("d"===i&&void 0!==r){let a;getVeljvoLetters(e).hasExpansion&&(p=!0);try{a=new RegExp(`^(${e.replace(/[^a-zA-Z0-9\{\}_]/g,"").replace(/([\{\}])/g,"\\$1")} \\([^\\(\\)<>]+?\\)).*`)}catch(a){console.log(e,t,a)}u.push({[e]:0!==e.search(a)?e:q.replace(a,"$1")})}let m=e.replace(/\$.*?\$/g,((e,a)=>{if("d"===i&&void 0!==r){o++;const a=`${r}_${o}`;c.push({[e]:a});const n=e.replace(/[^a-zA-Z0-9]/g,""),s=!!(t&&(t.rfs||[]).length>0),i=getVeljvoString({isHead:s,placeTag:e,fullDef:t,dataArrAdded:d,clearedPlaceTag:n}),l=s?i.replacement:e;e=`<span id="${a}" class="terbricmi" style="background: repeating-linear-gradient(to right,${bgString2Int(i.stringifiedPlaceTag,{})}), linear-gradient(90deg, ${bgString2Int(i.stringifiedPlaceTag,{l:"70%"})});background-origin: content-box, padding-box;background-clip: content-box, padding-box;padding: 1px;border-radius:10px;"${i.dataArr?` data-arr="${i.stringifiedPlaceTag}"`:""} data-color="${s?"":string2Int(i.stringifiedPlaceTag,256,32)}">${l}</span>`,d.push(n)}return e})).replace(/(<span [^<>]+?>[^\(\)<>]+?<\/span>) \([^\(\)<>]*?\bproperty of <span id="([^\(\)<>]+?)"[^<>]+?>([^\(\)<>]+?)<\/span>\)/g,((e,t,a,n)=>{if("d"===i){const t=c.filter((e=>e[n]!==a&&e[n]));t[0]&&t[0][n]&&(e=e.replace(/^<span /,`<span data-target="${t[0][n]}" `))}return e})).replace(/\$.*?\$/g,(e=>e.replace(/\{/g,"\\curlyleft").replace(/\}/g,"\\curlyright")));return l||(m=m.replace(/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g,(e=>{let t=`</span><a href="${e}" rel="noreferrer" target="_blank">${basna({def:e,query:a})}</a><span>`;return e.match(/^https?:\/\/.*\.(jpg|png)$/)&&(t+=`<img class='se-tcidu-pixra' alt='secusku' src="${e}"/>\n`),t}))),m=m.replace(/\{.*?\}/g,(e=>{e=e.substring(1,e.length-1);return`</span><a class="a-${n}" href="#seskari=${n}&sisku=${encodeUrl(e)}&bangu=${s}&versio=masno">${basna({def:escHtml(e,!0),query:a})}</a><span>`})).replace(/\$.*?\$/g,(e=>e.replace(/\\curlyleft/g,"{").replace(/\\curlyright/g,"}"))),m=`<span>${m}</span>`,m=m.replace(/<span><\/span>/g,"").replace(/(>[^<>$]+<|>[^<>$]+\$|\$[^<>$]+<)/g,(e=>basna({def:e,query:a}))).replace(/\n/g,"<br/>"),{tergeha:m,hasExpansion:p}}function escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function basna({def:e,query:t}){if(!t||t.length<=2)return e;let a=escapeRegExp(t=t.trim().replace(/[\|\(\)\{\}<>]/g,".")).split(" ").filter((e=>e.length>2)).concat(escapeRegExp(t.replace(/'/g,"h")).split(" ").filter((e=>e.length>2)));if(0===a.length)return e;const n=`(${a.join("|")})`;return e.replace(new RegExp(n,"igm"),"<span class='basna'>$1</span>")}function krulermorna(e){return e.replace(/\./g,"").replace(/^/,".").toLowerCase().replace(/([aeiou\.])u([aeiou])/g,"$1w$2").replace(/([aeiou\.])i([aeiou])/g,"$1ɩ$2").replace(/au/g,"ḁ").replace(/ai/g,"ą").replace(/ei/g,"ę").replace(/oi/g,"ǫ").replace(/\./g,"")}function cohukrulermorna(e){return e.replace(/w/g,"u").replace(/ɩ/g,"i").replace(/ḁ/g,"au").replace(/ą/g,"ai").replace(/ę/g,"ei").replace(/ǫ/g,"oi")}function zbalermornaize({w:e,ot:t,rfs:a}){let n=krulermorna(e);return n=n.split(/(?=[ɩw])/).map((e=>cohukrulermorna(e).split("").map((e=>latinToZbalermorna(e))).join(""))).join(""),n.replace(/,/g,"")}function latinToZbalermorna(e){return e.codePointAt(0)>=60800?e:" "==e?" ":("h"!=e&&"H"!=e||(e="'"),lerfu_index.includes(e)?String.fromCodePoint(60800+lerfu_index.indexOf(e)):lerfu_index.includes(e.toLowerCase())?String.fromCodePoint(60800+lerfu_index.indexOf(e.toLowerCase())):"\n"==e?"\n":"\t"==e?"\t":e)}function getMatchIndices(e,t){const a=new RegExp(e,"g"),n=[];let s;for(;s=a.exec(t);)n.push(s.index);return n}function onlyUnique(e,t,a){return a.indexOf(e)===t}function ConstructArxivoValsiExtract(e,t,a){let n=getMatchIndices(t,e);n=n.map((t=>((t=[t-a,t+a])[0]<0&&(t[0]=0),t[0]>=e.length&&(t[0]=e.length-1),t)));for(let e=0;e<n.length-1;e++)n[e][1]>n[e+1][0]&&(n[e][1]=n[e+1][1],n[e+1][0]=n[e][0]);if(n=n.map((e=>JSON.stringify(e))),n.length>0)n=n.filter(onlyUnique).map((a=>{a=JSON.parse(a);let n=e.substr(a[0],a[1]-a[0]);return n=basna({def:n,query:t}),a[0]>3&&(n=`...${n}`),a[1]<e.length-4&&(n=`${n}...`),n})),n=n.join("<br/>");else{let a=e.substr(0,Math.min(100,e.length));a.length<e.length&&(a=`${a}...`),a=basna({def:a,query:t}),n=a}return n}function jvoValue(){return jvoPlumbsOn?"⇔":"↔"}function skicu_palodovalsi({def:e,inner:t,query:a,seskari:n,bangu:s,index:i}){a||(a=state.searching.query),n||(n=state.searching.seskari),s=(s=e.bangu||s||state.searching.bangu).replace(/-cll/,""),e||(e=[]);const r=document.createElement("div");r.className=t?"terminner":"termouter",r.classList.add("term"),!t&&e.d&&e.d.nasezvafahi&&0===(e.rfs||[]).length&&(r.className="sidju sidju-normal cll noselect"),0===i&&r.classList.add("searchRendered");var l="string"==typeof e.s&&listFamymaho[e.s]?listFamymaho[e.s].split(" "):void 0;if(void 0!==l){let e="";var o=document.createElement("h4");o.className="tfm";for(let t of l)e+=`&nbsp;&nbsp;<i><sup>[&nbsp;...&nbsp;&nbsp;&nbsp;<a href="#seskari=${n}&sisku=${encodeUrl(t)}&bangu=${s}&versio=masno">${escHtml(t)}</a>]</sup></i>`;o.innerHTML=e}const c=[];for(const t in listFamymaho)listFamymaho[t].split(" ").includes(e.w)&&c.push(`<a href="#seskari=${n}&versio=selmaho&sisku=${encodeUrl(t)}&bangu=${s}">${escHtml(t)}</a>`);if(0!==c.length){var u=document.createElement("div");u.classList.add("valsi"),e.l&&u.classList.add("nalojbo"),u.innerHTML=`<i><sup>[${c.join(", ")}&nbsp;&nbsp;&nbsp;...&nbsp;]</sup></i>&nbsp;&nbsp;`}let d;if(e.s){const t="string"==typeof e.s?e.s.split(" "):e.s;if(t.length>0){d=document.createElement("div");for(const e of t){(g=document.createElement("button")).className="tutci klesi klesi-tutci";var p=basna({def:escHtml(e),query:a});g.innerHTML=p,g.setAttribute("onclick",`window.runSearch("${n}","${e}","${s}")`),d.appendChild(g)}}}var g;e.from&&((g=document.createElement("div")).className="tutci klesi klesi-tutci",g.innerHTML=e.from);let m=!1;const h=document.createElement("h4");if(h.classList.add("valsi"),e.d&&!e.d.nasezvafahi&&h.setAttribute("data-valsi",encodeValsiForWeb(e.w)),e.l&&h.classList.add("nalojbo"),e.t===window.bangudecomp||"fanva"===n||plukaquery(e.w)!=a&&"velcusku"!=n){let t=n;"fanva"===n&&(t="catni"),h.innerHTML=`<a class="valsi${e.l?"":" nalojbo"}" href="#seskari=${t}&sisku=${encodeUrl(e.w)}&bangu=${s}&versio=masno">${basna({def:escHtml(e.w,!0),query:a})}</a> `}else m=!0,h.innerHTML=`${basna({def:e.q||e.w,query:a})} `;let f;if(e.t&&!e.t.type){e.t="bangudecomp"===e.t?window.bangudecomp:e.t,f=document.createElement("a"),f.className="klesi link";let t=e.t;const a=encodeUrl(e.w).replace(/_/g,"%20");f.href=window.judri?window.judri+a:`#seskari=${"catni"===n?"catni":"cnano"}&sisku=${a}&bangu=${s}&versio=masno`,window.judri&&(f.setAttribute("target","_blank"),f.setAttribute("rel","noreferrer")),window.xuzganalojudri&&!e.l&&(t=`${escHtml(e.t)}# `,e.d&&e.d.nasezvafahi&&(t=`➕ ${t}`)),f.innerHTML=t}e.t&&e.t.type&&(f=document.createElement("a"),f.href="javascript:;",f.className="klesi",f.innerHTML=e.t.type,e.t.bangu&&"lojbo"!==e.t.bangu&&h.classList.add("na_eisesance")),e.date&&(f=document.createElement("div"),f.className="tutci klesi klesi-tutci",f.style.whiteSpace="nowrap",f.innerHTML=e.date);let k,y={};e.d&&!e.d.nasezvafahi&&(y=melbi_uenzi({def:e.d,fullDef:e,query:a,seskari:n,bangu:s,type:"d",index:i})),e.t&&0===e.t.k||"fanva"===n&&0!==i||(k=document.createElement("h4"),k.classList.add("valsi","zbalermorna","segerna","sampu"),k.textContent=zbalermornaize(e));const b=document.createElement("heading");let v;b.classList.add("heading"),u&&b.appendChild(u),b.appendChild(h),m&&(v=document.createElement("button"),v.className="fanva-tutci tutci klesi klesi-tutci",v.onclick=function(){state.searching={...state.searching,seskari:"fanva",query:plukaquery(e.w)},DispatchState({replace:!1})},v.innerHTML="🌍");const w=document.createElement("div");w.classList.add("segerna","sampu","noselect");const $=e.bangu&&supportedLangs[e.bangu].n?supportedLangs[e.bangu].n:e.bangu||"";if(w.innerHTML=$,o&&b.appendChild(o),f){const e=document.createElement("div");e.classList.add("sampu","noselect"),e.appendChild(f),f=e}let E;"lujvo"===e.t&&(e.rfs||[]).length>0&&y.hasExpansion&&(E=document.createElement("input"),E.type="button",E.classList.add("tutci","sance","jvo_plumber"),E.value=jvoValue(),jvoPlumbsOn?E.classList.add("tutci-hover"):E.classList.remove("tutci-hover"),E.onclick=addJvoPlumbs);let C=[];k&&!d&&e.w.length<10&&!E&&(C.push("zbalermorna"),b.appendChild(k));const x=document.createElement("heading");x.style.flex=1,b.appendChild(x),d||(b.appendChild(w),C.push("banguEl"),f&&(b.appendChild(f),C.push("jvs"))),m&&e.w.length<20&&(b.appendChild(v),C.push("translateButton")),E&&b.appendChild(E),d&&b.appendChild(d);const L=document.createElement("input");L.type="button",L.classList.add("tutci","sance","klesi-tutci"),L.value="📋",L.addEventListener("click",(function(){copyToClipboard([e.w,e.d,e.n].filter(Boolean).join("\r\n"))})),b.appendChild(L),r.appendChild(b);const S=document.createElement("heading");S.classList.add("heading","heading2"),k&&!C.includes("zbalermorna")&&S.appendChild(k);const j=document.createElement("heading");if(j.style.flex=1,S.appendChild(j),C.includes("banguEl")||S.appendChild(w),f&&!C.includes("jvs")&&S.appendChild(f),v&&!C.includes("translateButton")&&S.appendChild(v),r.appendChild(S),"arxivo"!==n&&e.d){if((I=document.createElement("div")).classList.add("definition","valsi"),e.d&&e.d.nasezvafahi){if(!e.t&&0===(e.rfs||[]).length)return;I.classList.add("nasezvafahi","noselect"),I.innerHTML=window.nasezvafahi}else{let e=y.tergeha;I.innerHTML=e}r.appendChild(I)}if("arxivo"===n){const t=document.createElement("div");t.classList.add("definition","valsi","pointer"),t.innerHTML=ConstructArxivoValsiExtract(e.d,a,50),t.addEventListener("click",(()=>{t.style.display="none",t.nextElementSibling.style.display="block"})),r.appendChild(t),(I=document.createElement("div")).classList.add("definition","valsi"),I.style.display="none",e.d&&e.d.nasezvafahi?(I.classList.add("nasezvafahi","noselect"),I.innerHTML=window.nasezvafahi):(I.innerHTML=`${basna({def:e.d,query:a})} `,I.addEventListener("click",(()=>{I.style.display="none",I.previousElementSibling.style.display="block",I.parentElement.scrollIntoView()}))),r.appendChild(I)}var I;e.n&&((I=document.createElement("div")).classList.add("notes","valsi"),I.innerHTML=`${melbi_uenzi({def:e.n,query:a,seskari:n,bangu:s}).tergeha} `,r.appendChild(I));e.e&&((I=document.createElement("div")).classList.add("examples","valsi"),I.innerHTML=`<table class='ciksi'>${melbi_uenzi({def:`${e.e}\n`.replace(/%/g,"\n").replace(/(.*?) — (.*?)\n/g,"<tr><td class='mupligreku'><b>$1</b></td><td class='mupligreku'><i>$2</i></td></tr>\n"),query:a,seskari:n,bangu:s}).tergeha}</table> `,r.appendChild(I));e.k&&((I=document.createElement("div")).className="related",I.innerHTML=`See also: ${melbi_uenzi({def:e.k,query:a,seskari:n,bangu:s}).tergeha} `,r.appendChild(I));if((e.r||[]).length>0&&!e.l&&window.xuzganalojudri){const t=document.createElement("div");t.className="rafsi noselect";const n=document.createElement("div");n.className="tanxe zunle_tanxe",n.innerHTML="rafsi",t.appendChild(n);const s=document.createElement("div");for(s.className="tanxe pritu_tanxe",_=0;_<e.r.length;_++){const t=document.createElement("span");t.className="pamei";const n=e.r[_];t.innerHTML=basna({def:n,query:a}),s.appendChild(t)}t.appendChild(s),r.appendChild(t)}if((e.b||[]).length>0&&!e.l&&window.xuzganalojudri){const t=document.createElement("div");t.className="rafsi noselect hue_rotate";const i=document.createElement("div");i.className="tanxe zunle_tanxe kurfa_tanxe",i.innerHTML="BAI",t.appendChild(i);const l=document.createElement("div");for(l.className="tanxe pritu_tanxe kurfa_tanxe",_=0;_<e.b.length;_++){const t=document.createElement("span");t.className="pamei";const i=e.b[_];t.innerHTML=`</span><a class="hue_rotate_back a-${n}" href="#seskari=${n}&sisku=${encodeUrl(i)}&bangu=${s}&versio=masno">${basna({def:escHtml(i,!0),query:a})}</a><span>`,l.appendChild(t)}t.appendChild(l),r.appendChild(t)}if((e.rfs||[]).length>0){const t=document.createElement("div");t.classList.add("definition","subdefinitions");for(var _=0;_<e.rfs.length;_++){const r=skicu_palodovalsi({def:e.rfs[_],inner:!0,index:`${i}_${_}`,query:a,seskari:n,bangu:s});r&&t.appendChild(r)}r.appendChild(t)}return r.addEventListener("click",clicked),r}function encodeValsiForWeb(e){return encodeURIComponent(e).replace(/'/g,"h")}function plukaquery(e){return"^"!==e.charAt(0)&&"$"!==e.slice(-1)?e.replace(/\./g," ").replace(/ {2,}/g," ").replace(/’/g,"'"):e}function encodeUrl(e){return encodeURIComponent((e||"").replace(/ /g,"_")).replace(/'/g,"%27")}function decodeUrl(e){return decodeURIComponent(e.replace(/&amp;/g,"&").replace(/%27/g,"'")).replace(/[_]/g," ")}function escHtml(e,t){return e=(e||"").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/\(/g,"&#40;").replace(/\)/g,"&#41;"),t||(e=e.replace(/'/g,"&#039;")),e}function skicu_rolodovalsi({query:e,seskari:t,bangu:a,versio:n}){const s=Math.min(window.jimte,results.length);for(state.cll=void 0;resultCount<s;resultCount++){const n=skicu_palodovalsi({def:results[resultCount],query:e,seskari:t,bangu:a,length:results.length,index:resultCount});n&&outp.appendChild(n)}}async function addAudioLinkForExternalSpeaker(e){worker.postMessage({kind:"parse",operation:"audioLink",tegerna:e.replace(/"/g,"")})}function sleep(e){return new Promise((t=>setTimeout(t,e)))}async function addAudioLinks(){const e=Array.from(document.querySelectorAll(":not(.na_eisesance)[data-valsi]"));for(let t of e)kahe_sezgana(t)&&(t=t.textContent.trim(),addAudioLinkForExternalSpeaker(t),await sleep(500))}function text(e,t,a){const n=document.createElement(e);return n.textContent=t,a&&(n.className=a),n}function elem(e,t,a){const n=document.createElement(e);return a&&(n.className=a),Array.isArray(t)?t.forEach((e=>{n.appendChild(e)})):t&&n.appendChild(t),n}function play(e){audio.src=e,audio.play()}function getStateBangu(){const e=macitri()[0];return e&&e.bangu?state.searching.bangu:"en"}if(window.ningau_lepasorcu=e=>{0!==e.indexOf("@")&&worker.postMessage({kind:"fancu",cmene:"ningau_lepasorcu",...state.searching,bangu:e})},window.runSearch=(e,t,a)=>{state.searching={seskari:e,versio:"selmaho",query:t,bangu:a},DispatchState({replace:!1})},document.querySelector("#table").appendChild(elem("table",rows.map((e=>elem("tr",e.map((e=>{const t=text("button",e,"bangu");return t.onclick=()=>{play(`/sutysisku/sance/lerfu/${encodeURIComponent(e)}.ogg`)},elem("td",t)}))))),"centero")),socket1Chat=io("wss://jbotcan.org:9091",{transports:["polling","websocket"]}),socket1Chat){function trimSocketChunk(e){return e.replace(/[\n\r]+$/gims," ").split("<")[0]}socket1Chat.on("connect",(function(){socket1Chat_connected=!0})),socket1Chat.on("connect_error",(function(){console.log("1chat connection error")})),socket1Chat.on("sentFrom",(function(e){if(loadingState.loading||!socket1Chat_connected)return;var t=e.data,a=trimSocketChunk(t.chunk),n=t.channelId,s=t.author;const i=document.getElementById("velsku_sebenji");i.innerHTML=`<img src='../pixra/nunsku.svg' class="velsku_pixra"/> <span class="velsku_pamei">[${n}] ${s}: ${a}</span>`,i.style.display="flex",i.href=`#seskari=cnano&sisku=lai jbosnu&bangu=${getStateBangu()}&versio=masno`})),socket1Chat.on("history",(function(e){if(loadingState.loading||!socket1Chat_connected)return;const t=document.getElementById("velsku_sebenji"),a=e.slice(-1)[0];if(!a)return;const n=trimSocketChunk(a.chunk),s=a.channelId,i=a.author;t.innerHTML=`<img src='../pixra/nunsku.svg' class="velsku_pixra"/> <span class="velsku_pamei">[${s}] ${i}: ${n}</span>`,t.style.display="flex",t.href=`#seskari=cnano&sisku=lai jbosnu&bangu=${getStateBangu()}&versio=masno`}))}function getPhonemeClasses(){const e="[bdgjvzcfkpstxlmnr]",t="(pl|pr|fl|fr|bl|br|vl|vr|cp|cf|ct|ck|cm|cn|cl|cr|jb|jv|jd|jg|jm|sp|sf|st|sk|sm|sn|sl|sr|zb|zv|zd|zg|zm|tc|tr|ts|kl|kr|dj|dr|dz|gl|gr|ml|mr|xl|xr)";return{C:e,V:"(a|e|i|o|u)",I:"(ai|ei|oi|au|ḁ|ą|ę|ǫ)",D:t,T:"(cfr|cfl|sfr|sfl|jvr|jvl|zvr|zvl|cpr|cpl|spr|spl|jbr|jbl|zbr|zbl|ckr|ckl|skr|skl|jgr|jgl|zgr|zgl|ctr|str|jdr|zdr|cmr|cml|smr|sml|jmr|jml|zmr|zml)",R:`((?!${t})${e}${e})`,J:"(i|u)(?=[aeiouyḁąęǫ])",h:"[h']"}}function allAreSafeWords(e,{allowCmevla:t=!1,allowCmavo:a=!1}){const{C:n,V:s,I:i,D:r,T:l,R:o,J:c,h:u}=getPhonemeClasses(),d=RegExp(`^(${r}${s}${n}${s}|${n}${s}${n}${n}${s})$`),p=RegExp(`^${n}${s}${n}${n}${i}$`),g=RegExp(`^${s}${n}${n}${s}$`),m=RegExp(`^${c}${s}${n}${n}${s}$`),h=RegExp(`^${l}${s}${o}${s}$`),f=RegExp(`^${r}${s}${n}${s}${n}${s}$`),k=RegExp(`^${r}${s}${n}${s}${n}${n}${s}$`),y=RegExp(`^${n}${s}${o}${s}${n}${n}${s}$`),b=RegExp(`^${n}${s}${o}${s}${n}${s}$`),v=RegExp(`^${r}${s}${n}${n}${s}$`),w=RegExp(`^${n}${s}${n}${n}${s}${u}${s}$`),$=RegExp(`^${n}${n}${s}${n}${s}${u}${s}$`);return e.every((e=>"gismu"===e[0]||d.test(e[1])||g.test(e[1])||m.test(e[1])||h.test(e[1])||f.test(e[1])||b.test(e[1])||p.test(e[1])||w.test(e[1])||$.test(e[1])||v.test(e[1])||k.test(e[1])||y.test(e[1])||t&&"cmevla"===e[0]||a&&"cmavo"===e[0]))}function PollyPlayer(e){function t(e,t){let a="^";const n=e.replace(/[\.\?»«]/g,"");for(let e=0;e<t.length;e++)"?"==t[e]?a+=".":"*"==t[e]?a+=".*":"C"==t[e]?a+="[^aeiouyḁąęǫ]":"V"==t[e]?a+="[aeiouyḁąęǫ]":"I"==t[e]&&(a+="[iu]");a+="$";return new RegExp(a).test(n)}function a(e,t){const a=Object.keys(e).filter((e=>RegExp(`^${e}`).test(t))).sort(((e,t)=>t.length-e.length))[0]??"-";return{match:a,value:e[a]}}async function n(n,s){const i=function(n){const s=["kei","vau","ku'o","li'u","le'u","ge'u","zo'u"],i=n.replace(/(?:\r\n|\r|\n)/g," ").split(" ");let r=['<speak><prosody rate="slow">',"<s>"];for(let n=0;n<i.length;n++){const l=krulermorna(i[n]);["i",".i","ni'o"].includes(l)?r.push("</s>\n<s>"):"."==l[0]&&r.push('<break time="20ms" strength="x-weak" />');let o=[];for(let s=0;s<[...l].length;s++){t(l,"VCV")&&0==s||t(l,"CVCV")&&0==s||t(l,"VCCV")&&0==s?o.push("ˈ"):t(l,"CVCCI")||t(l,"CVCCV")||t(l,"IVCCV")||t(l,"CCVCV")?(0==s&&o.push("ˈ"),3==s&&o.push(".")):t(l,"CCVCCV")?(0==s&&o.push("ˈ"),4==s&&o.push(".")):t(l,"CCCVCCV")?(0==s&&o.push("ˈ"),5==s&&o.push(".")):t(l,"CCVCVCV")||t(l,"CVCCVCV")?(3==s&&o.push(".ˈ"),5==s&&o.push(".")):(t(l,"CCVCVCCV")||t(l,"CVCCVCCV"))&&(3==s&&o.push(".ˈ"),6==s&&o.push("."));const{match:r,value:c}=a(e.lojban2IPAMapping,l.slice(s)+" "+i.concat("").slice(n+1).join(" "));o.push(c),s=s-1+r.replace(/\\/g,"").replace(/\(\?.*\)/g,"").length}const{C:c,V:u,I:d}=getPhonemeClasses();(RegExp(`(${c})$`).test(l)||RegExp(`^(${u}|${d})`).test(l))&&o.unshift("?");const p=o.join("").replace(/ʔ+/g,"ʔ").replace(/\.+/g,".");r.push(`<phoneme alphabet="ipa" ph="${p}">${l}</phoneme>`),("."==l[l.length-1]||s.includes(l))&&r.push('<break time="20ms" strength="x-weak" />')}return r.push("</s>","</prosody></speak>"),r.join("\n")}(n),r=function(e){const t=(JSON.parse(localStorage.getItem("cachedAudio"))||[]).filter((t=>t.text===e))[0];if(!t)return;return JSON.parse(t.audio).data}(i)||await function(t,a){return new Promise((function(n,s){(new AWS.Polly).synthesizeSpeech({Text:t,VoiceId:e.VoiceId,LanguageCode:e.LanguageCode,Engine:e.Engine,OutputFormat:"mp3",TextType:"ssml",SampleRate:"24000"},((e,i)=>{e?s():(!function(e,t,a){let n=JSON.parse(localStorage.getItem("cachedAudio"))||[];n=n.slice(a?-20:-10),n.push({text:e,audio:JSON.stringify(t)}),localStorage.setItem("cachedAudio",JSON.stringify(n))}(t,i.AudioStream,a),n(i.AudioStream))}))}))}(i,s);return!!s||new Promise((e=>{audio.src=URL.createObjectURL(new Blob([new Uint8Array(r).buffer])),audio.addEventListener("ended",(()=>e(!0))),audio.pause(),audio.play()}))}return AWS.config.credentials=new AWS.CognitoIdentityCredentials({IdentityPoolId:e.IdentityPoolId}),AWS.config.region=e.region,function(e,t){return n(e,t)}}function openSettingsModal(e){if(e.ctrlKey&&"ArrowDown"===e.key){const e=document.getElementById("jsModal");e.classList?e.classList.add("open"):e.className+=" open"}}function copyToClipboard(e){const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("Copy"),document.body.removeChild(t),showLoading({bangu:window.copied||"📋",hideProgress:!0}),setTimeout((()=>{showLoaded()}),2e3)}window.runSpeakableAudio=function(e,t=!1){return polly(e,t)},function(){var e;e=function(){for(var e=document.getElementsByClassName("jsModalClose"),t=document.getElementsByClassName("jsOverlay"),a=0;a<e.length;a++)e[a].onclick=function(){var e=this.parentNode.parentNode;e.classList?e.classList.remove("open"):e.className=e.className.replace(new RegExp("(^|\\b)"+"open".split(" ").join("|")+"(\\b|$)","gi")," ")};for(a=0;a<t.length;a++)t[a].onclick=function(){var e=this.parentNode;e.classList?e.classList.remove("open"):e.className=e.className.replace(new RegExp("(^|\\b)"+"open".split(" ").join("|")+"(\\b|$)","gi")," ")}},"loading"!=document.readyState?e():document.addEventListener("DOMContentLoaded",e)}(),window.resetAudioParams=()=>{const e=pollyParams;localStorage.setItem("audioParams",JSON.stringify(e)),textArea.value=JSON.stringify(e,null,2),polly=PollyPlayer(e),localStorage.setItem("cachedAudio",null)};